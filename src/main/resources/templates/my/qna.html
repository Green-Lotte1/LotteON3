<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org"
       xmlns:layout="http://www.thymeleaf.org"
       layout:decorate="/my/_my_layout">
<!-- qna -->
<section layout:fragment="content">
    <script>
        function sendQnaNo(event) {

        $('.answerRow').hide();

         event.preventDefault(); // 기본 링크 동작 방지
         var qnaNo = event.target.getAttribute('data-qnaNo'); // data-qnaNo 값을 가져옴
         // 클릭된 title 요소의 부모 tr을 찾습니다.
        var row = $(event.target).closest('tr');

        // 클릭된 title 요소의 부모 tr 내에서 .answerRow를 찾아 토글합니다.



        //답변
        const answerRow = $(event.target).parent().parent().next();
        answerRow.show();


        alert(answerRow.text());
         // qnaNo를 서버로 전송하는 AJAX 요청을 수행
                 $.ajax({
                     type: "GET",
                     url: "/LotteON/my/qna/comment?qnaNo=" + qnaNo,
                     success: function(data) {
                        // 서버에서 반환한 데이터를 처리
                        var response = data[0];
                        var title = response.title; // JSON 데이터에서 title 가져오기
                        var content = response.content; // JSON 데이터에서 content 가져오기
                        var date = response.rdate;

                        // HTML 요소에 데이터 추가
                        var answerDiv = $(this).find(".answer");
                        var dateSpan = answerDiv.find(".date");
                        var contentP = answerDiv.find(".content");

                        dateSpan.text(date);
                        contentP.text(content);

                       // 필요에 따라 title 정보를 다른 곳에 추가
                       $(".your-title-container").text(title);
                       },
                     error: function(error){
                            console.error(error)
                    }

				});
        };
    </script>
    <a href="#"><img th:src="@{/images/my/my_banner2.png}" alt="패션, 타운 하나로 끝" class="banner"></a>
    <article>
        <h3>문의하기</h3>

        <table border="0">
            <tr>
                <th>번호</th>
                <th>문의채널</th>
                <th>문의유형</th>
                <th>제목</th>
                <th>작성일</th>
                <th>상태</th>
            </tr>
            <th:block th:each="ltCsQnaDTO, iterStat : ${ltCsQnaDTO}">
                <tr class="questionRow">
                    <td class="no" th:text="${pageStartNum - iterStat.index-1}"></td>
                    <td class="channel">고객센터</td>
                    <td class="type">[[${ltCsQnaDTO.c2Name}]]</td>
                    <td class="tit"><a href="#" th:attr="data-qnaNo=${ltCsQnaDTO.qnaNo}" th:text="${ltCsQnaDTO.title}" onclick="sendQnaNo(event)">[[${ltCsQnaDTO.title}]]</a></td>
                    <td th:text="${#temporals.format(ltCsQnaDTO.rdate, 'yyyy-MM-dd')}"></td>
                    <th:block>
                        <td th:class="blue-text" th:if="${ltCsQnaDTO.answerComplete == 2}">답변완료</td>
                        <td th:class="gray-text" th:if="${ltCsQnaDTO.answerComplete == 1}">검토중</td>
                    </th:block>
                <tr class="answerRow">
                    <td colspan="6">
                        <div class="question">
                            <p class="tit">
                                [[${ltCsQnaDTO.title}]]
                                <span class="date" th:text="${#temporals.format(ltCsQnaDTO.rdate, 'yyyy-MM-dd HH:mm:ss')}"></span>
                            </p>
                            <p class="content">
                                [[${ltCsQnaDTO.content}]]
                            </p>
                        </div>
                        <div class="answer">
                            <p class="tit">
                                <span class="date"></span>
                            </p>
                            <p class="content"></p>
                        </div>
                    </td>
                </tr>
                </tr>
            </th:block>

        </table>

        <p class="page">
            <th:block th:if="${pageGroupStart > 1}">
                <a th:href="@{/my/qna(pg=${pageGroupStart - 1})}" class="prev">이전</a>
            </th:block>
            <th:block th:each="num:${#numbers.sequence(pageGroupStart, pageGroupEnd)}">
                <a th:href="@{/my/qna(pg=${num})}" th:classappend="${num == currentPage} ? 'on' : 'num'">[[${num}]]</a>
            </th:block>
            <th:block th:if="${pageGroupEnd < lastPageNum}">
                <a th:href="@{/my/qna(pg=${pageGroupEnd + 1})}" class="next">다음</a>
            </th:block>
        </p>
    </article>
</section>
<!-- qna END -->
</html>